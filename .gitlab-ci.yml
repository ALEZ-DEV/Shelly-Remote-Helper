stages:
  - build
  - deploy

build_release:
  stage: build
  variables:
    GIT_STRATEGY: clone
  only:
    - master
  only:
    - tags
  script: cargo build --release

deploy_release:
  stage: deploy
  needs: ["build_release"]
  only:
    - tags
    - /^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+*$/
    - master
  script:
    - call C:\novellLogin\login.bat
    - md "\\mach17\techdata\Release\ShellyRemoteHelper\%CI_COMMIT_TAG%"
    - xcopy_deploy ".\target\release\Shelly-Remote-Helper.exe" "\\mach17\techdata\Release\ShellyRemoteHelper\%CI_COMMIT_TAG%" /I /E /Y